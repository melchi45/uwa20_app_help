(function(){"use strict";angular.module("nvd3",[]).directive("nvd3",["utils",function(utils){return{restrict:"AE",scope:{data:"=",options:"=",api:"=?",events:"=?",config:"=?"},link:function(scope,element,attrs){var defaultConfig={extended:false,visible:true,disabled:false,autorefresh:true,refreshDataOnly:false,deepWatchData:true,debounce:10};scope._config=angular.extend(defaultConfig,scope.config);scope.api={refresh:function(){scope.api.updateWithOptions(scope.options)},update:function(){scope.chart.update()},updateWithOptions:function(options){scope.api.clearElement();if(angular.isDefined(options)===false)return;if(!scope._config.visible)return;scope.chart=nv.models[options.chart.type]();scope.chart.id=Math.random().toString(36).substr(2,15);angular.forEach(scope.chart,function(value,key){if(["options","_options","_inherited","_d3options","state","id","resizeHandler"].indexOf(key)>=0);else if(key==="dispatch"){if(options.chart[key]===undefined||options.chart[key]===null){if(scope._config.extended)options.chart[key]={}}configureEvents(scope.chart[key],options.chart[key])}else if(["lines","lines1","lines2","bars","bars1","bars2","stack1","stack2","multibar","discretebar","pie","scatter","bullet","sparkline","legend","distX","distY","xAxis","x2Axis","yAxis","yAxis1","yAxis2","y1Axis","y2Axis","y3Axis","y4Axis","interactiveLayer","controls"].indexOf(key)>=0){if(options.chart[key]===undefined||options.chart[key]===null){if(scope._config.extended)options.chart[key]={}}configure(scope.chart[key],options.chart[key],options.chart.type)}else if((key==="xTickFormat"||key==="yTickFormat")&&options.chart.type==="lineWithFocusChart");else if(options.chart[key]===undefined||options.chart[key]===null){if(scope._config.extended)options.chart[key]=value()}else scope.chart[key](options.chart[key])});scope.api.updateWithData(scope.data);if(options["title"]||scope._config.extended)configureWrapper("title");if(options["subtitle"]||scope._config.extended)configureWrapper("subtitle");if(options["caption"]||scope._config.extended)configureWrapper("caption");if(options["styles"]||scope._config.extended)configureStyles();nv.addGraph(function(){if(scope.chart!==null){scope.chart.resizeHandler=resizeHandler;$(window).bind("resize",resizeHandler)}return scope.chart},options.chart["callback"])},updateWithData:function(data){if(data){scope.options.chart["transitionDuration"]=+scope.options.chart["transitionDuration"]||250;d3.select(element[0]).select("svg").remove();d3.select(element[0]).append("svg").attr("height",scope.options.chart.height).attr("width",scope.options.chart.width||"100%").datum(data).transition().duration(scope.options.chart["transitionDuration"]).call(scope.chart)}},clearElement:function(){element.find(".title").remove();element.find(".subtitle").remove();element.find(".caption").remove();element.empty();if(scope.chart){if(scope.chart.resizeHandler){$(window).unbind("resize",resizeHandler);delete scope.chart.resizeHandler}for(var i=0;i<nv.graphs.length;i++){if(nv.graphs[i]!==null){if(nv.graphs[i].id===scope.chart.id){nv.graphs.splice(i,1)}}}}scope.chart=null;nv.tooltip.cleanup()},getScope:function(){return scope}};function resizeHandler(){scope.chart.update()}function configure(chart,options,chartType){if(chart&&options){angular.forEach(chart,function(value,key){if(key==="dispatch"){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]={}}configureEvents(value,options[key])}else if(["scatter","defined","options","axis","rangeBand","rangeBands","_options","_inherited","_d3options","_calls"].indexOf(key)<0){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]=value()}else chart[key](options[key])}})}}function configureEvents(dispatch,options){if(dispatch&&options){angular.forEach(dispatch,function(value,key){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]=value.on}else dispatch.on(key+"._",options[key])})}}function configureWrapper(name){var _=utils.deepExtend(defaultWrapper(name),scope.options[name]||{});if(scope._config.extended)scope.options[name]=_;var wrapElement=angular.element("<div></div>").html(_["html"]||"").addClass(name).addClass(_.class).removeAttr("style").css(_.css);if(!_["html"])wrapElement.text(_.text);if(_.enable){if(name==="title")element.prepend(wrapElement);else if(name==="subtitle")element.find(".title").after(wrapElement);else if(name==="caption")element.append(wrapElement)}}function configureStyles(){var _=utils.deepExtend(defaultStyles(),scope.options["styles"]||{});if(scope._config.extended)scope.options["styles"]=_;angular.forEach(_.classes,function(value,key){value?element.addClass(key):element.removeClass(key)});element.removeAttr("style").css(_.css)}function defaultWrapper(_){switch(_){case"title":return{enable:false,text:"Write Your Title","class":"h4",css:{width:scope.options.chart.width+"px",textAlign:"center"}};case"subtitle":return{enable:false,text:"Write Your Subtitle",css:{width:scope.options.chart.width+"px",textAlign:"center"}};case"caption":return{enable:false,text:"Figure 1. Write Your Caption text.",css:{width:scope.options.chart.width+"px",textAlign:"center"}}}}function defaultStyles(){return{classes:{"with-3d-shadow":true,"with-transitions":true,gallery:false},css:{}}}scope.$watch("options",utils.debounce(function(newOptions){if(!scope._config.disabled&&scope._config.autorefresh)scope.api.refresh()},scope._config.debounce,true),true);scope.$watch("data",function(newData,oldData){if(newData!==oldData&&scope.chart){if(!scope._config.disabled&&scope._config.autorefresh){scope._config.refreshDataOnly?scope.chart.update():scope.api.refresh()}}},scope._config.deepWatchData);scope.$watch("config",function(newConfig,oldConfig){if(newConfig!==oldConfig){scope._config=angular.extend(defaultConfig,newConfig);scope.api.refresh()}},true);angular.forEach(scope.events,function(eventHandler,event){scope.$on(event,function(e){return eventHandler(e,scope)})});element.on("$destroy",function(){scope.api.clearElement()})}}}]).factory("utils",function(){return{debounce:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}},deepExtend:function(dst){var me=this;angular.forEach(arguments,function(obj){if(obj!==dst){angular.forEach(obj,function(value,key){if(dst[key]&&dst[key].constructor&&dst[key].constructor===Object){me.deepExtend(dst[key],value)}else{dst[key]=value}})}});return dst}}})})();