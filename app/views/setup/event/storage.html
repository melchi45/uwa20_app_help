<div class="wrapper wrapper-content" id="storagepage" ng-show="pageLoaded" style="display:none">
    <form class="form-horizontal" method="get" name="storageForm" novalidate="">
        <fieldset class="storage-fieldset" ng-disabled='isLoading'>

        <wn5-setup-main-title
            data-title="lang_menu_storage">
        </wn5-setup-main-title>
        <div class="wn5-setup-section">
            <hr class="wn5-setup-hr">
            <div class="wn5-setup-section-heading">
                <h3>
                    {{ 'lang_storageActionSetup' | translate }}
                </h3>
            </div>
            <div class="wn5-setup-section-article wn5-setup-section">
                <div class="form-group" ng-if="MaxChannel > 1">
                    <setup-channel-selector 
                        use-info="true"
                        use-channel="false"
                        ng-if="MaxChannel > 1">
                    </setup-channel-selector>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-content wn5-setup-table-responsive">
                        <table class="table table-bordered table-editor wn5-setup-table" style="text-align:center; margin-bottom: 20px;">
                            <thead>
                                <tr>
                                    <th>
                                    </th>
                                    <th style="text-align:center">
                                        {{ 'lang_device' | translate}}
                                    </th>
                                    <th style="text-align:center">
                                        {{ 'lang_record' | translate}}
                                    </th>
                                    <th style="text-align:center">
                                        {{ 'lang_freeSize' | translate}}
                                    </th>
                                    <th style="text-align:center">
                                        {{ 'lang_totalSize' | translate}}
                                    </th>
                                    <th style="text-align:center">
                                        {{ 'lang_status' | translate}}
                                    </th>
                                    <th>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr 
                                    ng-repeat="Storage in Storageinfo.Storages"
                                    ng-class="{'wn5-setup-table-active': selected === $index }">
                                    <td>
                                        <input 
                                            ng-change="OnStorageSelection($index)" 
                                            ng-model="$parent.selected" 
                                            ng-value="$index" 
                                            type="radio">
                                        </input>
                                    </td>
                                    <td>
                                        <!-- <label style="text-align:center"> -->
                                        <div ng-if="Storage.Type === 'SD'">
                                            {{ 'lang_SDCard' | translate }}
                                        </div>
                                        <div ng-if="Storage.Type !== 'SD'">
                                            {{Storage.Type}}
                                        </div>
                                        <!-- </label> -->
                                    </td>
                                    <td>
                                        <select 
                                            class="form-control" 
                                            ng-change="OnStorageEnable(Storage.Enable)" 
                                            ng-disabled="$parent.selected != $index || isLoading" 
                                            ng-model="Storage.Enable" 
                                            style="text-align:center">
                                            <option 
                                                ng-repeat="Enable in RecordEnableOptions track by Enable" 
                                                ng-selected="Storage.Enable == Enable" 
                                                value="{{Enable}}">
                                                {{getTranslatedOption(Enable)}}
                                            </option>
                                        </select>
                                    </td>
                                    <td>
                                        <!-- <label ng-disabled="$parent.selected != $index" style="text-align:center"> -->
                                            {{Storage.UsedSpace}}
                                        </label>
                                    </td>
                                    <td>
                                        <!-- <label ng-disabled="$parent.selected != $index" style="text-align:center"> -->
                                            {{Storage.TotalSpace}}
                                        <!-- </label> -->
                                    </td>
                                    <td>
                                        <img src='./base/images/loading-tp.gif' ng-show='Storage.isProcessing' width='25'></img>
                                        <span ng-disabled="$parent.selected != $index" ng-show="Storage.Status === 'None'" style="text-align:center">
                                            {{getTranslatedOption(Storage.Status)}}
                                        </span>
                                        <span ng-disabled="$parent.selected != $index" ng-show="Storage.Status === 'Recording'|| Storage.Status === 'Formatting' || Storage.Status === 'Lock' || Storage.Status === 'Full' || Storage.Status === 'Ready'" style="color:blue">
                                            {{getTranslatedOption(Storage.Status)}}
                                        </span>                                        
                                        <span ng-disabled="$parent.selected != $index" ng-show="Storage.Status === 'Error'" style="color:red">
                                            {{getTranslatedOption(Storage.Status)}}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-primary cm-btn-dark" ng-click="OnStorageFormat($index)" ng-disabled="($parent.selected != $index || GetFormatButtonStatus($index)) && isLoading || getOnOffStatus($index)" style="text-align:center" type="button">
                                            {{ 'lang_format' | translate }}
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading" style="text-align:left">
                        {{ 'lang_overwrite' | translate }}
                    </div>
                    <div class="wn5-setup-section-article-content">
                        <label>
                             <input ng-disabled="Storageinfo.Storages[SelectedStorage].Enable === 'Off'" ng-model="RecordStorageInfo.OverWrite" type="checkbox">
                            {{'lang_enable' | translate}}
                        </label>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <div class="wn5-setup-section-article-content wn5-setup-section-article-heading-offset">
                        <div class="wn5-setup-preview-table-col-4 wn5-setup-storage-auto-delete">
                            <input ng-disabled="(!RecordStorageInfo.OverWrite) || (Storageinfo.Storages[SelectedStorage].Enable === 'Off')" ng-model="RecordStorageInfo.AutoDeleteEnable" type="checkbox" ng-click="tests()">
                            {{'lang_autoDelete' | translate}}
                        </div>
                        <div class="col-xs-12 col-sm-5 wn5-setup-storage-days">
                            <input class="form-control wn5-setup-section-article-content-unit-small" maxlength="{{AutoDeleteDayOptions.max.toString().length}}" name="AutoDeleteDays" ng-disabled="!RecordStorageInfo.AutoDeleteEnable || !RecordStorageInfo.OverWrite || Storageinfo.Storages[SelectedStorage].Enable === 'Off'" ng-model="RecordStorageInfo.AutoDeleteDays" ng-pattern-restrict="{{ OnlyNumStr}}" type="text" style="width: 50px;">
                            <span>{{ 'lang_days' | translate }}</span>
                            <span>
                                (1 ~ 180)
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div ng-show="Storageinfo.Storages[SelectedStorage].Type === 'SD'">
                <hr class="wn5-setup-hr">
                <div class="wn5-setup-section-heading">
                    <h3>
                        {{ 'lang_SDfileSystem' | translate }}
                    </h3>
                </div>
                <div class="wn5-setup-section-article form-group">
                    <div class="wn5-setup-section-article-heading" style="text-align:left">
                        {{ 'lang_evenlang_storage_type' | translate }}
                    </div>
                    <div class="wn5-setup-section-article-content">
                        <select class="form-control" ng-disabled="(Storageinfo.Storages[SelectedStorage].Enable === 'Off') || (pageData.Storageinfo.Storages[SelectedStorage].Enable === 'Off')" ng-model="Storageinfo.Storages[SelectedStorage].FileSystem" ng-options="FileSystem for FileSystem in FileSystemTypeOptions track by FileSystem" type="text">
                        </select>
                    </div>
                </div>
            </div>
            <div ng-show="Storageinfo.Storages[SelectedStorage].Type === 'NAS'">
                <hr class="wn5-setup-hr">
                <div class="wn5-setup-section-heading">
                    <h3>
                        {{ 'lang_nasConnectionSetup' | translate }}
                        &nbsp;
                        <span 
                            ng-show="NASTestStatus === 'Connecting' || NASTestStatus === 'Fail' || NASTestStatus === 'Success'"
                            style="color:red;">
                            {{checkNASStatus(NASTestStatus)}}
                        </span>
                    </h3>
                </div>
                <div class="wn5-setup-section-article">
                    <div class="form-group">
                        <div class="wn5-setup-section-article-heading" style="text-align:left">
                            {{ 'lang_IPAddress' | translate }}
                        </div>
                        <div class="wn5-setup-section-article-content">
                            <input 
                                class="form-control" 
                                maxlength="{{NASIPMaxLen}}" 
                                name="NASIP" 
                                ng-disabled="!(Storageinfo.Storages[SelectedStorage].Status === 'None')" 
                                ng-model="Storageinfo.Storages[SelectedStorage].NASConfig.NASIP" 
                                ng-pattern-restrict="{{IPv4PatternStr}}" 
                                type="text">
                            </input>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="wn5-setup-section-article-heading" style="text-align:left">
                            {{ 'lang_ID' | translate }}
                        </div>
                        <div class="wn5-setup-section-article-content">
                            <input class="form-control" maxlength="{{NASUserIDMaxLen}}" name="NASUserID" ng-disabled="!(Storageinfo.Storages[SelectedStorage].Status === 'None')" ng-model="Storageinfo.Storages[SelectedStorage].NASConfig.NASUserID" ng-pattern-restrict="{{NASUserIDPattern}}" type="text">
                            </input>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="wn5-setup-section-article-heading" style="text-align:left">
                            {{ 'lang_password' | translate }}
                        </div>
                        <div class="wn5-setup-section-article-content">
                            <input autocomplete="new-password" class="form-control" maxlength="{{NASPasswordMaxLen}}" name="NASPassword" ng-change="nasPasswordInit(SelectedStorage)" ng-click="nasPasswordInit(SelectedStorage)" ng-disabled="!(Storageinfo.Storages[SelectedStorage].Status === 'None')" ng-model="Storageinfo.Storages[SelectedStorage].NASConfig.NASPasswordNew" ng-pattern-restrict="{{NASPasswordPattern}}" type="password">
                            </input>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="wn5-setup-section-article-heading" style="text-align:left">
                            {{ 'lang_defaultFolder' | translate }}
                        </div>
                        <div class="wn5-setup-section-article-content">
                            <input class="form-control" maxlength="{{DefaultFolderMaxLen}}" name="DefaultFolder" ng-disabled="!(Storageinfo.Storages[SelectedStorage].Status === 'None')" ng-model="Storageinfo.Storages[SelectedStorage].NASConfig.DefaultFolder" ng-pattern-restrict="{{NASFolderPattern}}" type="text">
                            </input>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="wn5-setup-section-article-content wn5-setup-section-article-heading-offset">
                            <button class="btn btn-primary cm-btn-dark" ng-click="OnNASTest()" ng-disabled="!(Storageinfo.Storages[SelectedStorage].Status === 'None')" type="button">
                                {{ 'lang_test' | translate }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <hr 
            class="wn5-setup-hr"
            ng-show="MaxChannel > 1">

    </fieldset>

        <wn5-setup-main-title 
            data-title="lang_menu_record" 
            ng-show="MaxChannel > 1">
        </wn5-setup-main-title>
        <div class="wn5-setup-section" ng-if="MaxChannel > 1">
            <hr class="wn5-setup-hr">
            <div class="form-group wn5-setup-section-article">
                <setup-channel-selector
                    use-confirm="true"
                    ng-if="MaxChannel > 1"
                ></setup-channel-selector> 
            </div>
        </div>
        <div class="wn5-setup-section">
            <hr class="wn5-setup-hr">
            <div class="wn5-setup-section-heading">
                <h3>{{ 'lang_record_settings' | translate }}</h3>
            </div>
            <div class="wn5-setup-section-article">
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading">{{ 'lang_recordProfile' | translate }}</div>
                    <div class="wn5-setup-section-article-content">
                        <!-- 선택중인 채널의 record profile 정보가 보일 곳-->
                        {{ RecordProfileName }}
                    </div>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading">{{ 'lang_normal_recording' | translate }}</div>
                    <div class="wn5-setup-section-article-content">
                        <select 
                            name="NormalMode" 
                            class="form-control"
                            ng-model="RecordGeneralInfo.NormalMode">
                                <option ng-repeat="option in RecNormalModeOptions" value="{{option}}">
                                    {{option == 'Full'?getTranslatedOption('FullFrame'):option == 'Off'?getTranslatedOption('None'):getTranslatedOption(option)}}
                                </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading">{{ 'lang_event_recording' | translate }}</div>
                    <div class="wn5-setup-section-article-content">
                        <select 
                            name="eventRecording" 
                            class="form-control"
                            ng-model="RecordGeneralInfo.EventMode">
                                <option ng-repeat="option in RecEventModeOptions" value="{{option}}">
                                    {{option == 'Full'?getTranslatedOption('FullFrame'):option == 'Off'?getTranslatedOption('None'):getTranslatedOption(option)}}
                                </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading">{{ 'lang_preEventDuration' | translate }}</div>
                    <div class="wn5-setup-section-article-content">
                        <select 
                            name="preEvent" 
                            class="form-control"
                            ng-model="RecordGeneralInfo.PreEventDuration">
                                <option ng-repeat="option in RecPreEventDurationOptions" value="{{ option }}">
                                    {{ option.split('s')[0] }} {{'lang_seconds' | translate }}
                                </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading">{{ 'lang_postEventDuration' | translate }}</div>
                    <div class="wn5-setup-section-article-content">
                        <select 
                            name="postEvent" 
                            class="form-control"
                            ng-model="RecordGeneralInfo.PostEventDuration">
                                <option ng-repeat="option in RecPostEventDurationOptions" value="{{ option }}">
                                    {{ option.split('s')[0] }} {{'lang_seconds' | translate }}
                                </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="wn5-setup-section-article-heading">{{'lang_recordFileType'| translate}}</div>
                    <div class="wn5-setup-section-article-content">
                        <select 
                            name="fileType" 
                            class="form-control"
                            ng-model="RecordGeneralInfo.RecordedVideoFileType">
                                <option ng-repeat="option in RecVideoFileTypeOptions" value="{{ option }}">
                                    {{ option }}
                                </option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="wn5-setup-section">
            <hr class="wn5-setup-hr">
            <div class="wn5-setup-section-heading">
                <h3>{{ 'lang_normalRecordSetup' | translate }}</h3>
            </div>
            <div class="wn5-setup-section-article">
                <div class="wn5-setup-section-article-content">
                    <div ng-class="RadioClassLg" ng-repeat="Activate in ActivateOptions">
                        <input class="radio" name="Activate" ng-model="RecordSchedule.Activate" ng-value="Activate" type="radio">
                        <div ng-if="Activate === 'Scheduled'">
                        {{ 'lang_recording_only_schedule' | translate }}
                        </div>
                        <div ng-if="Activate === 'Always'">
                            {{ 'lang_recording_always' | translate }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--<div id="scheduler"></div>-->
        <scheduler></scheduler>
        
        <hr class="wn5-setup-hr">

        <wn5-setup-common-button
            data-submit-click="submit()"
            data-cancel-click="view()">
        </wn5-setup-common-button>
    </form>
</div>